{% extends "base_detail.html" %}

{% block title %}
    {{ item.name.ukr or item.name.rus or item.name.eng or "Без назви" }}
{% endblock %}

{% block extra_styles %}
    /* Include your custom prose styles from your original race_details.html */
    .prose {
        max-width: 100%;
        margin-bottom: 1.5rem;
        font-family: 'Georgia', serif;
        line-height: 1.6;
        color: #333;
    }
    .prose strong {
        display: block;
        font-weight: 700;
        font-size: 1.125rem;
        margin: 1.5rem 0 0.5rem 0;
        cursor: pointer;
        color: #2563eb;
        transition: color 0.3s;
        user-select: none;
    }
    .prose strong:hover {
        text-decoration: underline;
        color: #1d4ed8;
    }
    .prose p {
        text-indent: 1.5rem;
        max-height: 1000px;
        overflow: hidden;
        transition: max-height 0.4s ease, opacity 0.4s ease;
        opacity: 1;
    }
    .prose p.hidden {
        max-height: 0;
        opacity: 0;
        margin: 0 !important;
        padding: 0 !important;
    }
    .prose p[style*="display: none"] {
        max-height: 0;
        opacity: 0;
        margin: 0;
        padding: 0;
    }
    .prose p:not([style*="display: none"]) {
        max-height: 1000px;
        opacity: 1;
    }
    .prose strong+p {
        border-top: 1px solid #e5e7eb;
        padding-top: 1rem;
        margin-top: 1rem;
    }
{% endblock %}

{% block content %}
    {% if item.description %}
    <div class="prose max-w-none mb-6">
        {{ item.description | safe }}
    </div>
    {% endif %}

    {% if item.traits %}
    <details class="mb-4">
        <summary class="cursor-pointer text-xl font-semibold text-blue-700 hover:underline">Риси раси</summary>
        <ul class="list-disc list-inside mt-2 ml-4 space-y-1">
            {% for trait in item.traits %}
            <li>{{ trait }}</li>
            {% endfor %}
        </ul>
    </details>
    {% endif %}

    {% if item.ability_bonuses %}
    <div class="mt-4">
        <h2 class="text-xl font-semibold mb-2">Бонуси до характеристик</h2>
        <ul class="list-disc list-inside">
            {% for attr, bonus in item.ability_bonuses.items() %}
            <li>{{ attr }}: +{{ bonus }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const prose = document.querySelector(".prose");
        if (!prose) return;

        const paragraphs = Array.from(prose.querySelectorAll("p"));

        paragraphs.forEach(p => {
            const strong = p.querySelector("strong");
            if (strong) {
                strong.remove();
                p.parentNode.insertBefore(strong, p);
            }
        });

        const strongs = Array.from(prose.querySelectorAll("strong"));

        strongs.forEach((strong, index) => {
            strong.classList.add("cursor-pointer", "text-blue-600", "hover:underline");

            let nextStrong = strongs[index + 1];
            let elemsToHide = [];
            let sibling = strong.nextElementSibling;

            while (sibling && sibling !== nextStrong) {
                if (sibling.tagName.toLowerCase() !== "strong") {
                    elemsToHide.push(sibling);
                }
                sibling = sibling.nextElementSibling;
            }

            elemsToHide.forEach(p => p.style.display = "none");

            strong.addEventListener("click", () => {
                elemsToHide.forEach(p => {
                    p.style.display = (p.style.display === "none") ? "" : "none";
                });
            });
        });
    });
</script>
{% endblock %}